<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Mode - Circle Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            background-color: #f0f0f0;
        }
        #canvas {
            border: 1px solid #000;
            margin-bottom: 20px;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        #filters {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #filters label {
            margin: 5px 0;
        }
        #filters input {
            margin-left: 10px;
        }
        #circleList {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            width: 300px;
        }
        .circle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border: 1px solid #ddd;
            margin-bottom: 5px;
        }
        .circle-item button {
            padding: 5px 10px;
            font-size: 12px;
            background-color: #f44336;
            color: white;
        }
        .circle-item button:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>Developer Mode - Circle Editor</h1>
    <canvas id="canvas" width="800" height="600"></canvas>
    <div id="controls">
        <button id="addCircleBtn">Добавить круг</button>
        <button id="clearBtn">Очистить</button>
        <button id="saveBtn">Сохранить</button>
        <button id="loadBtn">Загрузить</button>
    </div>
    <div id="filters">
        <label><input type="checkbox" id="showAll"> Показать все</label>
        <label><input type="checkbox" id="showNew"> Показать новые (красные)</label>
        <label><input type="checkbox" id="showOld"> Показать старые (синие)</label>
    </div>
    <div id="circleList"></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let circles = [];
        let newCircles = new Set(); // Для отслеживания новых кругов
        let background = new Image();
        background.src = 'https://raw.githubusercontent.com/rolling-scopes-school/stage1-tasks/assets/images/evening/01.jpg'; // Пример фона

        // Генерация уникального ID
        function generateId() {
            return Date.now() + Math.random();
        }

        // Сохранение кругов в localStorage
        function saveCircles() {
            localStorage.setItem('circles', JSON.stringify(circles));
        }

        // Загрузка кругов из localStorage
        function loadCircles() {
            const saved = localStorage.getItem('circles');
            if (saved) {
                circles = JSON.parse(saved);
                renderCircles();
                updateFilters();
            }
        }

        // Рендеринг кругов
        function renderCircles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Рисуем фон, если загружен
            if (background.complete) {
                ctx.drawImage(background, 0, 0, canvas.width, canvas.height);
            }
            // Рисуем круги
            circles.forEach(circle => {
                if (newCircles.has(circle.id)) {
                    ctx.fillStyle = 'red';
                } else {
                    ctx.fillStyle = 'blue';
                }
                ctx.beginPath();
                ctx.arc(circle.x, circle.y, 15, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Обновление фильтров и списка кругов
        function updateFilters() {
            const showAll = document.getElementById('showAll').checked;
            const showNew = document.getElementById('showNew').checked;
            const showOld = document.getElementById('showOld').checked;

            const circleList = document.getElementById('circleList');
            circleList.innerHTML = '';

            circles.forEach(circle => {
                let visible = false;
                if (showAll || (showNew && newCircles.has(circle.id)) || (showOld && !newCircles.has(circle.id))) {
                    visible = true;
                }

                if (visible) {
                    const item = document.createElement('div');
                    item.className = 'circle-item';
                    item.textContent = `Круг ${circle.id.toFixed(0)}: (${circle.x.toFixed(0)}, ${circle.y.toFixed(0)})`;
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Удалить';
                    deleteBtn.addEventListener('click', () => {
                        circles = circles.filter(c => c.id !== circle.id);
                        newCircles.delete(circle.id);
                        saveCircles();
                        renderCircles();
                        updateFilters();
                    });
                    item.appendChild(deleteBtn);
                    circleList.appendChild(item);
                }
            });

            renderCircles();
        }

        // Вспомогательная функция для добавления круга в позицию
        function addCircleAtPosition(x, y) {
            const id = generateId();
            circles.push({ id, x, y });
            newCircles.add(id); // Новый круг - красный
            saveCircles();
            renderCircles();
            updateFilters(); // Обновить фильтры после добавления
        }

        // Обработчики кнопок
        document.getElementById('addCircleBtn').addEventListener('click', () => {
            let x, y;
            if (circles.length > 0) {
                // Найти последний добавленный круг (по индексу в массиве)
                const lastCircle = circles[circles.length - 1];
                x = lastCircle.x + 8; // Сдвиг на 1% вправо (8px при ширине 800)
                y = lastCircle.y; // Та же высота
                // Если выходит за пределы, сбросить в начало (опционально)
                if (x > canvas.width - 15) x = 50; // Сброс влево, если слишком далеко
            } else {
                // Если кругов нет, добавить в центр
                x = canvas.width / 2;
                y = canvas.height / 2;
            }
            addCircleAtPosition(x, y);
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            circles = [];
            newCircles.clear();
            saveCircles();
            renderCircles();
            updateFilters();
        });

        document.getElementById('saveBtn').addEventListener('click', saveCircles);
        document.getElementById('loadBtn').addEventListener('click', loadCircles);

        // Обработчики фильтров
        document.getElementById('showAll').addEventListener('change', updateFilters);
        document.getElementById('showNew').addEventListener('change', updateFilters);
        document.getElementById('showOld').addEventListener('change', updateFilters);

        // Загрузка фона и начальный рендер
        background.onload = () => renderCircles();
        loadCircles(); // Загрузить сохранённые круги при старте
    </script>
</body>
</html>
